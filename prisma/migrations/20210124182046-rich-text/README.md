# Migration `20210124182046-rich-text`

This migration has been generated by Mateus Machado at 1/24/2021, 3:20:46 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Bubble" (
"id" SERIAL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "title" TEXT NOT NULL,
    "description" TEXT NOT NULL,
    "authorId" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "User" (
"id" SERIAL,
    "email" TEXT NOT NULL,
    "name" TEXT,
    "avatarUrl" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Label" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "color" TEXT NOT NULL DEFAULT E'#b36fd8',

    PRIMARY KEY ("id")
)

CREATE TABLE "Comment" (
"id" SERIAL,
    "authorId" INTEGER,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "bubbleId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "ContentBlock" (
"id" SERIAL,
    "html" TEXT NOT NULL,
    "tag" TEXT NOT NULL,
    "bubbleId" INTEGER,
    "commentId" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "Like" (
"id" SERIAL,
    "authorId" INTEGER NOT NULL,
    "bubbleId" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_BubbleToLabel" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "Label.name_unique" ON "Label"("name")

CREATE UNIQUE INDEX "_BubbleToLabel_AB_unique" ON "_BubbleToLabel"("A", "B")

CREATE INDEX "_BubbleToLabel_B_index" ON "_BubbleToLabel"("B")

ALTER TABLE "Bubble" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("bubbleId")REFERENCES "Bubble"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "ContentBlock" ADD FOREIGN KEY("bubbleId")REFERENCES "Bubble"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ContentBlock" ADD FOREIGN KEY("commentId")REFERENCES "Comment"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Like" ADD FOREIGN KEY("authorId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Like" ADD FOREIGN KEY("bubbleId")REFERENCES "Bubble"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_BubbleToLabel" ADD FOREIGN KEY("A")REFERENCES "Bubble"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_BubbleToLabel" ADD FOREIGN KEY("B")REFERENCES "Label"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201230014442-likes..20210124182046-rich-text
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -14,9 +14,9 @@
   id          Int      @default(autoincrement()) @id
   createdAt   DateTime @default(now())
   title       String
   description String
-  content     String
+  content     ContentBlock[]
   author      User?     @relation(fields: [authorId], references: [id])
   authorId    Int?
   labels      Label[]
   comments    Comment[]
@@ -42,13 +42,19 @@
 model Comment {
   id          Int      @default(autoincrement()) @id
   author      User?    @relation(fields: [authorId], references: [id])
   authorId    Int?
-  content     String
+  content     ContentBlock[]
   createdAt   DateTime @default(now())
   bubble      Bubble
 }
+model ContentBlock {
+  id    Int  @default(autoincrement()) @id
+  html  String
+  tag   String
+}
+
 model Like {
   id          Int      @default(autoincrement()) @id
   author      User     @relation(fields: [authorId], references: [id])
   authorId    Int
```


